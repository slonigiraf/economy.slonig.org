import BN from 'bn.js';
import crypto from 'crypto';

export const gdpPerCapita: Record<string, number> = {
    LU: 106343,
    IE: 91648,
    CH: 89556,
    KY: 81412,
    NO: 78912,
    US: 65875,
    SG: 65422,
    QA: 65111,
    AU: 61584,
    DK: 61296,
    MO: 59602,
    IS: 59096,
    SE: 54450,
    NL: 51306,
    GB: 47323,
    AT: 46339,
    FI: 45589,
    BE: 44731,
    CA: 44469,
    DE: 44337,
    HK: 43573,
    IL: 42853,
    AE: 42508,
    NZ: 41767,
    AD: 40227,
    FR: 39117,
    JP: 36990,
    KR: 34121,
    IT: 34088,
    MT: 33001,
    CY: 32341,
    BS: 31054,
    PR: 30123,
    BN: 28725,
    ES: 28570,
    SI: 25709,
    BH: 25077,
    KW: 24155,
    SA: 23332,
    GY: 23103,
    PT: 22292,
    KN: 21506,
    GR: 21139,
    CZ: 20246,
    EE: 20123,
    BB: 19734,
    SK: 19239,
    LT: 18686,
    UY: 18296,
    OM: 18099,
    AG: 18091,
    PL: 17391,
    HR: 17147,
    PA: 16873,
    SC: 16715,
    LV: 16704,
    HU: 16283,
    TT: 16062,
    TR: 14714,
    CR: 14319,
    CL: 14227,
    AR: 12933,
    RO: 12399,
    PW: 12380,
    CN: 12175,
    MV: 11486,
    KZ: 11453,
    LC: 11440,
    MY: 11430,
    MU: 11319,
    RU: 10421,
    MX: 10242,
    BG: 9820,
    GD: 9728,
    VC: 9386,
    BR: 9258,
    DO: 8857,
    ME: 8403,
    DM: 8400,
    RS: 8211,
    TM: 7880,
    LY: 7633,
    CU: 7450,
    BW: 7236,
    SR: 7195,
    CO: 6819,
    PE: 6553,
    GA: 6542,
    BA: 6507,
    BY: 6483,
    PY: 6432,
    TH: 6394,
    MK: 6394,
    EC: 6238,
    BZ: 6212,
    GE: 6181,
    LB: 5909,
    ZA: 5747,
    FJ: 5737,
    IR: 5668,
    AZ: 5651,
    MH: 5470,
    AL: 5420,
    JM: 5329,
    AM: 5151,
    GQ: 5118,
    XK: 4889,
    DZ: 4660,
    SV: 4481,
    GT: 4471,
    MN: 4457,
    CV: 4196,
    ID: 4193,
    EG: 4178,
    IQ: 4176,
    WS: 4003,
    LK: 3969,
    NA: 3965,
    TN: 3959,
    JO: 3950,
    VN: 3760,
    PH: 3746,
    MD: 3729,
    SZ: 3726,
    UZ: 3726,
    MA: 3403,
    BT: 3336,
    BO: 3226,
    FM: 2986,
    PS: 2863,
    LA: 2649,
    VU: 2628,
    HN: 2527,
    PG: 2497,
    NG: 2416,
    AO: 2333,
    CI: 2303,
    NI: 2257,
    IN: 2236,
    UA: 2160,
    GH: 2087,
    KH: 2084,
    KI: 2003,
    SB: 1945,
    BD: 1885,
    KE: 1808,
    CG: 1677,
    PK: 1664,
    MR: 1630,
    CM: 1467,
    SN: 1463,
    ZW: 1411,
    TJ: 1407,
    KM: 1383,
    ST: 1381,
    ZM: 1331,
    BJ: 1300,
    TL: 1278,
    KG: 1264,
    HT: 1219,
    MM: 1178,
    NP: 1136,
    SL: 1102,
    TZ: 1093,
    GN: 1028,
    RW: 1004,
    LS: 974,
    UG: 956,
    TG: 922,
    ET: 875,
    YE: 859,
    SD: 767,
    ML: 763,
    GW: 752,
    BF: 739,
    GM: 728,
    LR: 653,
    MZ: 610,
    TD: 567,
    MW: 557,
    NE: 541,
    CD: 537,
    MG: 448,
    CF: 398,
    AF: 380,
    BI: 254,
    LO: 65875
};
export const VALIDITY = 730;
export const oneSlon = new BN('1000000000000');
export const diplomaPriceFractionOfGDPperCapita = 0.007770973;
export const warrantyMultiplier = 1.2;

export function getAirdropAmount(country: string) : BN {
    return new BN(Math.round(0.15355908906 * gdpPerCapita[country])).mul(oneSlon);
}
export function getDiplomaPrice(country: string) : BN {
    return new BN(Math.round(diplomaPriceFractionOfGDPperCapita * gdpPerCapita[country])).mul(oneSlon);
}
export function getWarrantyAmount(country: string): BN {
    return new BN(Math.round(warrantyMultiplier * diplomaPriceFractionOfGDPperCapita * gdpPerCapita[country])).mul(oneSlon);
}

export function hashRecipient(address: string): string {
  return crypto.createHash('sha256').update(address).digest('hex');
}

export function maskIp(ip: string): string {
  if (!ip) return 'unknown';
  if (ip.includes(':')) {
    // IPv6: keep first 6 hextets, mask last 2
    return ip.split(':').slice(0, 6).join(':') + '::';
  } else {
    // IPv4: keep first 2 octets
    const parts = ip.split('.');
    if (parts.length === 4) {
      return `${parts[0]}.${parts[1]}.0.0`;
    }
  }
  return ip;
}